<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <link rel='stylesheet' href='/screen.css'>
  <link href='http://fonts.googleapis.com/css?family=Cabin:600|Lora:400,700'
    rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">
  <title>Using Segment with Ember.js - mattlayman.com</title>
  <meta name='viewport' content='width=device-width' />
  <meta property="og:type" content="article" />
<meta property="og:url" content="http://www.mattlayman.com/2016/ember-segment.html" />
<meta property="og:image" content="http://www.mattlayman.com/images/og.jpeg" />
<meta property="og:title" content="Using Segment with Ember.js" />
<meta property="og:description" content="Ember CLI makes using Segment a snap. Learn about the core features of ember-cli-segment." />
  <meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@mblayman" />
<meta name="twitter:image" content="http://www.mattlayman.com/images/og.jpeg" />
<meta name="twitter:title" content="Using Segment with Ember.js" />
<meta name="twitter:description" content="Ember CLI makes using Segment a snap. Learn about the core features of ember-cli-segment." />
  <link rel='alternate' href='/feed.xml' title="Matt Layman's Writings"
    type='atom+xml'>
  <script src="//load.sumome.com/" data-sumo-site-id="bebd12621ec197c6697df2c9248f3a0e593a38b2eae32e10899930dae8668b9a" async="async"></script>
</head>
<body>
<div id='container'>
  <h1>Using Segment with Ember.js</h1>
<p class='byline'>By <a href='/'>Matt Layman</a> on December 20, 2016</p>
<p><img class='book' src='segment.png'></p>
<p>I&rsquo;ve been working on
<a href="https://www.collegeconductor.com/">College Conductor</a>
to help serve Independent Educational Consultants
(like <a href="https://laymancollegeconsulting.com/">this one</a> :)
and high school guidance counselors.
To find product market fit,
I&rsquo;m using <a href="https://segment.com/">Segment</a>
which gets the data I need
to decide how to improve the service.
In this post,
<strong>I&rsquo;ll describe how I connected Segment
to College Conductor&rsquo;s
<a href="http://emberjs.com/">Ember.js</a> frontend.</strong></p>
<p>Working with Segment in Ember can be done with
<a href="https://github.com/josemarluedke/ember-cli-segment">ember-cli-segment</a>,
an Ember addon that provides an Ember
<a href="https://guides.emberjs.com/v2.1.0/applications/services/">service</a>
to communicate with Segment.
The first thing I did was install the addon with:</p>
<div class="codehilite"><pre><span></span>$ ember install ember-cli-segment
</pre></div>


<p><code>ember-cli-segment</code> has a solid README on their GitHub page
that instructs users what to do at a very detailed level.
Before getting buried in details,
I had two initial goals with this addon.</p>
<ol>
<li>Connect to Segment to record basic analytics.</li>
<li>Utilize the <a href="https://segment.com/docs/sources/server/http/#identify">identify</a>
   API to connect users to their actions.</li>
</ol>
<p>Once these two goals were completed,
I could monitor enough behavior
to make data based decisions
about what to improve
in the product.</p>
<h2>Connect to Segment</h2>
<p>Connecting the Ember app to Segment involved adding my Segment write key
to the app&rsquo;s configuration. The result
in my <code>environment.js</code> file
was something like:</p>
<div class="codehilite"><pre><span></span><span class="nx">ENV</span><span class="p">[</span><span class="s1">&#39;segment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">WRITE_KEY</span><span class="o">:</span> <span class="s1">&#39;my_segment_write_key&#39;</span>
<span class="p">}</span>
</pre></div>


<p>With that much configuration,
data started flowing from College Conductor to Segment.
Exciting!</p>
<h2>Identifying users</h2>
<p>My second goal of identifying users
was done with an application route hook.
If you create a method named <code>identifyUser</code>
in your application route,
then <code>ember-cli-segment</code> will make the <code>identify</code> API call
on your behalf.</p>
<p>I had to supply a user ID
and whatever other information I wanted.
At this stage in my product development,
including the account username
is all the extra data I want.</p>
<p>My code in <code>app/application/route.js</code> looks like:</p>
<div class="codehilite"><pre><span></span><span class="nx">identifyUser</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;currentUser.user&#39;</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;segment&#39;</span><span class="p">).</span><span class="nx">identifyUser</span><span class="p">(</span>
      <span class="nx">user</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">),</span> <span class="p">{</span><span class="nx">username</span><span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">)});</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>This code grabs the authenticated user
from the <code>currentUser</code> service
that I created
and identifies that user with Segment.</p>
<h2>Thankful</h2>
<p>By the time I finished
with this work,
I was very grateful for <code>ember-cli-segment</code>.
The addon made my job much easier.
This is one of the things that I really like
about the Ember community.
Ember CLI addons can take out some
of the very heavy development work.
That means I can spend more time
on College Conductor
and less time on the nuts and bolts
of service integration.</p>
<p>If you want to chat about this with me, I'm
  <a href="https://twitter.com/mblayman">@mblayman</a> on Twitter.</p>
  <br>
  <footer>
    <p><img alt='Creative Commons Attribution 4.0 International License'
      src='/cc.png' width='80' height='15'> <a href='/'> Matt Layman</a>,
      2017</p>
  </footer>
</div>
</body>
</html><!-- handrolled for excellence -->
