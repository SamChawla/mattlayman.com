<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <link rel='stylesheet' href='/screen.css'>
  <link href='http://fonts.googleapis.com/css?family=Cabin:600|Lora:400,700'
    rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">
  <title>Feature flags and waffles - mattlayman.com</title>
  <meta name='viewport' content='width=device-width' />
  <meta property="og:type" content="article" />
<meta property="og:url" content="http://www.mattlayman.com/2017/feature-flags-and-waffles.html" />
<meta property="og:image" content="http://www.mattlayman.com/2017/waffles.jpg" />
<meta property="og:title" content="Feature flags and waffles" />
<meta property="og:description" content="Modern software development has a strong focus on continuously delivering new code, and many businesses do not have the luxury to ship code on an infrequent schedule. How can an engineering team manage this speed of development and produce a quality product? One invaluable tool to achieve this goal is feature flags. Learn more about what feature flags are and how they work." />
  <meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@mblayman" />
<meta name="twitter:image" content="http://www.mattlayman.com/2017/waffles.jpg" />
<meta name="twitter:title" content="Feature flags and waffles" />
<meta name="twitter:description" content="Modern software development has a strong focus on continuously delivering new code, and many businesses do not have the luxury to ship code on an infrequent schedule. How can an engineering team manage this speed of development and produce a quality product? One invaluable tool to achieve this goal is feature flags. Learn more about what feature flags are and how they work." />
  <link rel='alternate' href='/feed.xml' title="Matt Layman's Writings"
    type='atom+xml'>
  <script src="//load.sumome.com/" data-sumo-site-id="bebd12621ec197c6697df2c9248f3a0e593a38b2eae32e10899930dae8668b9a" async="async"></script>
</head>
<body lang='en'>
<div id='container'>
  <h1>Feature flags and waffles</h1>
<p class='byline'>By <a href='/'>Matt Layman</a> on June 27, 2017</p>
<p><img class='book' src='waffles.jpg'></p>
<p>You&rsquo;re on a team
that wants to ship a Super Cool New Featureâ„¢.</p>
<p>The feature will cause changes all over your web app.
Instead of releasing the work in pieces,
the marketing team wants to have a big reveal
to create a buzz.
<em>How do you manage this challenge?</em></p>
<p>One option is to keep all the work in a separate code branch.
When everything is done,
merge the code back into your main branch,
ship it,
and reveal it to the world.
<strong>Whoa, hold on, that sounds risky.</strong></p>
<p>What could <em>possibly</em> go wrong? Well, how about:</p>
<ol>
<li>Other changes continued on your main branch
   and now your long lived feature branch is <strong>full of conflicts</strong>
   with your main branch.</li>
<li>Your feature code was only tested
   by developers
   and is <strong>full of bugs</strong>
   that destroy the usability
   of your Super Cool New Feature.</li>
</ol>
<p>That sounds&hellip; <strong>terrible</strong>.</p>
<p>How can we <em>continuously deliver</em> the feature
without killing the marketing buzz?
We can use <strong>feature flags.</strong></p>
<h2>Feature flags</h2>
<blockquote>
<p>Feature flags are a tool
that give development teams the ability
to expose a feature
in a controlled manner.</p>
</blockquote>
<p>You might come across feature flags
as <a href="https://martinfowler.com/articles/feature-toggles.html"><em>feature toggles</em></a>
or <em>feature flippers</em>.
Even though the names are different,
the intent is the same.
With feature flags,
a team controls which features are active
<strong>and</strong> which people see those active features.</p>
<p>A feature flag functions as a configurable point
in a system
that a team can enable or disable.
In code,
a feature flag looks a little like:</p>
<div class="codehilite"><pre><span></span><span class="k">if</span> <span class="n">feature_flag_is_active</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">super_cool_new_feature</span><span class="p">()</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">old_behavior</span><span class="p">()</span>
</pre></div>


<p>What makes <code>feature_flag_is_active</code> true or not can depend
on who the user is.
This extra level
of control
is useful
to gate the release.</p>
<p>We could enable our Super Cool New Feature
for the marketing team (or QA)
in advance.
This gives them time to review,
provide feedback,
and let&rsquo;s us address bugs.</p>
<p>I can tell you
from personal experience
that mastery
over the feature timeline
is a huge boon
for <a href="https://storybird.com/">Storybird</a>.
The team at Storybird can polish features
before sharing them
with hundreds of thousands
of teachers and students.</p>
<p>Now that you&rsquo;re equipped
with the knowledge
of what feature flags are,
let&rsquo;s explore one library
that implements them.
Go get the syrup
because we&rsquo;re going to be talking about waffles,
er,
<code>django-waffle</code>.</p>
<h2>Are you waffling?</h2>
<blockquote>
<p><strong>waffle</strong>: verb - EQUIVOCATE, VACILLATE</p>
<p><a href="https://www.merriam-webster.com/dictionary/waffle">Merriam-Webster</a></p>
</blockquote>
<p><a href="http://waffle.readthedocs.io/en/latest/index.html">Django Waffle</a>
is a feature flag library
that can enable or disable code,
as described previously,
and is quick
to add to any Django project.</p>
<p>Waffle includes
<a href="http://waffle.readthedocs.io/en/latest/types/index.html">a few types of feature control</a>.
For our purposes,
I&rsquo;m going to focus
on flags
as they are the most interesting
and powerful type.</p>
<p><code>waffle.flag_is_active</code> is the critical method
for the Waffle flags API.</p>
<p>Suppose part of our Super Cool New Feature is a new template design
for our product page.
If the original product view looked like:</p>
<div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">ProductView</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># Do work to build template context...</span>
        <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;old_design.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</pre></div>


<p>Then our new code that adds a Waffle flag would look like:</p>
<div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">ProductView</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># Do work to build template context...</span>
        <span class="k">if</span> <span class="n">waffle</span><span class="o">.</span><span class="n">flag_is_active</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;super_cool_new_feature&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;new_design.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;old_design.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</pre></div>


<p>Let&rsquo;s break down how this works.</p>
<p>Waffle stores flag settings
in a database table.
A team controls the available flags
via the <a href="https://docs.djangoproject.com/en/1.11/ref/contrib/admin/">Django admin</a>.
From the admin site,
a developer can set a flag&rsquo;s name,
enabled/disabled status,
and some filters
for more specific control
like superuser, staff, or specific group access.</p>
<p>When the view executes,
<code>flag_is_active</code> inspects <code>request.user</code>
against the settings decribed
in the <code>super_cool_new_feature</code> database row.
If the user meets the criteria,
the function evaluates to <code>True</code>
and your new code will run.</p>
<p>For the Super Cool New Feature,
Waffle can be called in every place
that needs to be changed
using the same feature flag name.
This introduces a way to turn the feature on (or off!)
with a quick edit in the Django admin.</p>
<h2>Wrapping up</h2>
<p>Maybe you&rsquo;ve come this far
and a question has percolated up
through your mind.</p>
<blockquote>
<p>Isn&rsquo;t this more complicated?</p>
</blockquote>
<p><strong>Yes, it is.</strong>
Like every engineering choice,
feature flags have trade-offs.</p>
<p>By adding a feature flag directly to the code,
we create clean up work
when the feature flag is no longer needed.
This clean up work takes time,
but it is better than the alternative.
<em>A long lived feature branch
almost always causes trouble.</em></p>
<blockquote>
<p><em>Feature flags divorce the shipping of features
from the revelation of features.</em></p>
</blockquote>
<p>This flexibility is great
for teams that need to move fast.
And there are amazing side benefits
like creating a work culture
that delivers code constantly.
Constant delivery <strong><em>builds trust</em></strong>
between an engineering team
and other teams
because of a tight feedback loop.
If you&rsquo;re looking
for a way to move your team faster
and improve your workplace,
give feature flags a shot!</p>
<p>If you want to chat about this with me, I'm
  <a href="https://twitter.com/mblayman">@mblayman</a> on Twitter.</p>
  <br>
  <footer>
    <p><img alt='Creative Commons Attribution 4.0 International License'
      src='/cc.png' width='80' height='15'> <a href='/'> Matt Layman</a>,
      2017</p>
  </footer>
</div>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-93541554-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html><!-- handrolled for excellence -->
