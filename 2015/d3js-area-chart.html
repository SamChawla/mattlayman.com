<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <link rel='stylesheet' href='/screen.css'>
  <link href='http://fonts.googleapis.com/css?family=Cabin:600|Lora'
    rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">
  <title>A "simple" D3.js area chart - mattlayman.com</title>
  <meta name='viewport' content='width=device-width' />
  <link rel='alternate' href='/feed.xml' title="Matt Layman's Writings"
    type='atom+xml'>
</head>
<body>
<div id='container'>
  <h1>A "simple" D3.js area chart</h1>
<p class='byline'>By <a href='/'>Matt Layman</a> on January 24, 2015</p>
<p>Let&rsquo;s take:</p>
<table>
  <thead>
    <tr><th>X</th><th>Y</th></tr>
  </thead>
  <tbody>
    <tr><td>0</td><td>10</td></tr>
    <tr><td>1</td><td>15</td></tr>
    <tr><td>2</td><td>35</td></tr>
    <tr><td>3</td><td>20</td></tr>
  </tbody>
</table>

<p>And make:</p>
<p><svg id="area" /></p>
<p>D3.js is mindbending, and I find the examples on the D3.js wiki to be too
little explanation with too much going on. In this example, I will show
you how to make the simplest area chart I could devise. If you want to
jump straight to &ldquo;the answer,&rdquo; see <a href="area.js">the complete JavaScript</a>.</p>
<p>D3.js is not a chart library. It is a chart <em>parts</em> library. The library feels
like a mashup of SVG and data manipulation with some sugar sprinkled on top.
While immensely flexible, the flexibility comes at the cost of complexity.
Let&rsquo;s dive in.</p>
<p>To build the chart, we need: data, an SVG container, margins, an X axis, a Y
axis, the area shape itself, and some CSS to make it look pretty.</p>
<h4>Data</h4>
<p>We&rsquo;re not going to mess with TSV or CSV loaders or any of the callback stuff.
Here is the data, plain and simple.</p>
<div class="codehilite"><pre><span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span> <span class="nx">x</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">y</span><span class="o">:</span> <span class="mi">10</span><span class="p">,</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">x</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">y</span><span class="o">:</span> <span class="mi">15</span><span class="p">,</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">x</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">y</span><span class="o">:</span> <span class="mi">35</span><span class="p">,</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">x</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span> <span class="nx">y</span><span class="o">:</span> <span class="mi">20</span><span class="p">,</span> <span class="p">},</span>
<span class="p">];</span>
</pre></div>


<h4>SVG</h4>
<p>D3 uses SVG (Scalable Vector Graphics) to draw its shapes. It&rsquo;s possible to
create a new <code>&lt;svg&gt;</code> tag on the fly, but I added the following to the HTML
source code.</p>
<div class="codehilite"><pre><span class="nt">&lt;svg</span> <span class="na">id=</span><span class="s">&quot;area&quot;</span> <span class="nt">/&gt;</span>
</pre></div>


<h4>Margins</h4>
<p>Charts in D3 have no margins, but the primary D3 author frequently talks about
defining <a href="http://bl.ocks.org/mbostock/3019563">conventional margins</a>. The idea
is to make some margins and define an SVG group (i.e. the <code>g</code> tag) that is
set to those margin boundaries. The code only considers the group tag as the
drawable area.</p>
<div class="codehilite"><pre><span class="kd">var</span> <span class="nx">margin</span> <span class="o">=</span> <span class="p">{</span><span class="nx">top</span><span class="o">:</span> <span class="mi">20</span><span class="p">,</span> <span class="nx">right</span><span class="o">:</span> <span class="mi">20</span><span class="p">,</span> <span class="nx">bottom</span><span class="o">:</span> <span class="mi">40</span><span class="p">,</span> <span class="nx">left</span><span class="o">:</span> <span class="mi">50</span><span class="p">},</span>
    <span class="nx">width</span> <span class="o">=</span> <span class="mi">575</span> <span class="o">-</span> <span class="nx">margin</span><span class="p">.</span><span class="nx">left</span> <span class="o">-</span> <span class="nx">margin</span><span class="p">.</span><span class="nx">right</span><span class="p">,</span>
    <span class="nx">height</span> <span class="o">=</span> <span class="mi">350</span> <span class="o">-</span> <span class="nx">margin</span><span class="p">.</span><span class="nx">top</span> <span class="o">-</span> <span class="nx">margin</span><span class="p">.</span><span class="nx">bottom</span><span class="p">;</span>
</pre></div>


<h4>Axes</h4>
<p>To draw data in a scalable way, D3 needs to be able to map the data (e.g.,
x=0, y=10) to a pixel position. We must take the X data and set it on the
axis so that the maximum X value (i.e. 3) matches the pixel width of the
chart area. Because D3 is so flexible, it means that X and Y must be
defined independently.</p>
<p>In math class, you were probably taught that X is for the domain
and Y is for the range. Unfortunately, D3 uses domain/range terms to apply to
axes too. We have to think about the X data (0 - 3) as the domain, and the
chart horizontal dimension (0 - <code>width</code>) as the range. The same kind of
thinking has to be applied for the Y axis as well (0 - 35 applied to the
chart vertical dimension).</p>
<p>You can think of the <code>x</code> and <code>y</code> variables as translator functions that take
a domain value and convert it to a pixel size. <code>xAxis</code> and <code>yAxis</code> are
indicating where the axes should go.</p>
<div class="codehilite"><pre><span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">scale</span><span class="p">.</span><span class="nx">linear</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">domain</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">d</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span> <span class="p">})])</span>
    <span class="p">.</span><span class="nx">range</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="nx">width</span><span class="p">]);</span>

<span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">scale</span><span class="p">.</span><span class="nx">linear</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">domain</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">d</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span> <span class="p">})])</span>
    <span class="p">.</span><span class="nx">range</span><span class="p">([</span><span class="nx">height</span><span class="p">,</span> <span class="mi">0</span><span class="p">]);</span>

<span class="kd">var</span> <span class="nx">xAxis</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">svg</span><span class="p">.</span><span class="nx">axis</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">scale</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">orient</span><span class="p">(</span><span class="s2">&quot;bottom&quot;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">yAxis</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">svg</span><span class="p">.</span><span class="nx">axis</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">scale</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">orient</span><span class="p">(</span><span class="s2">&quot;left&quot;</span><span class="p">);</span>
</pre></div>


<h4>Area</h4>
<p>The area function transforms each data point like (2, 35) into information
that describes the shape. Each corresponds to an x position, an upper y
position, <code>y1</code>, and a lower y position, <code>y0</code>. The odd thing here is that <code>y0</code>
is set to the constant of <code>height</code>. This makes sense when you know that SVGs
are positioned relative to the upper left corner of the graphic. Any distance
&ldquo;down&rdquo; is a positive number, so a positive <code>height</code> means the bottom of the
graphic.</p>
<div class="codehilite"><pre><span class="kd">var</span> <span class="nx">area</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">svg</span><span class="p">.</span><span class="nx">area</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">x</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">x</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span> <span class="p">})</span>
    <span class="p">.</span><span class="nx">y0</span><span class="p">(</span><span class="nx">height</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">y1</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">y</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span> <span class="p">});</span>
</pre></div>


<h4>Putting it all together</h4>
<p>So far, we have not done anything except define some data and functions.
Now we need to put those functions to work.</p>
<div class="codehilite"><pre><span class="kd">var</span> <span class="nx">svg</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s2">&quot;svg#area&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;width&quot;</span><span class="p">,</span> <span class="nx">width</span> <span class="o">+</span> <span class="nx">margin</span><span class="p">.</span><span class="nx">left</span> <span class="o">+</span> <span class="nx">margin</span><span class="p">.</span><span class="nx">right</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;height&quot;</span><span class="p">,</span> <span class="nx">height</span> <span class="o">+</span> <span class="nx">margin</span><span class="p">.</span><span class="nx">top</span> <span class="o">+</span> <span class="nx">margin</span><span class="p">.</span><span class="nx">bottom</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;g&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;transform&quot;</span><span class="p">,</span> <span class="s2">&quot;translate(&quot;</span> <span class="o">+</span> <span class="nx">margin</span><span class="p">.</span><span class="nx">left</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span> <span class="o">+</span> <span class="nx">margin</span><span class="p">.</span><span class="nx">top</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">);</span>

<span class="nx">svg</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;path&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">datum</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span> <span class="s2">&quot;area&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="nx">area</span><span class="p">);</span>

<span class="nx">svg</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;g&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span> <span class="s2">&quot;x axis&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;transform&quot;</span><span class="p">,</span> <span class="s2">&quot;translate(0,&quot;</span> <span class="o">+</span> <span class="nx">height</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">xAxis</span><span class="p">);</span>

<span class="nx">svg</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;g&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span> <span class="s2">&quot;y axis&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">yAxis</span><span class="p">);</span>
</pre></div>


<p>The variable definition of <code>svg</code> grabs the <code>svg</code> tag with ID <code>area</code> and
adds a group tag, <code>g</code>, to define the margins within the SVG. All the
drawing will happen inside this <code>g</code> tag.</p>
<p>The next section adds a <code>path</code>. This is where the data and the area function
meet. <em>It is the keystone of this entire example.</em> D3 uses each data
point and passes it to the <code>area</code> function. The <code>area</code> function translates
the data into positions on the path in the SVG. It will result in:</p>
<div class="codehilite"><pre><span class="nt">&lt;path</span> <span class="na">class=</span><span class="s">&quot;area&quot;</span> <span class="na">d=</span><span class="s">&quot;M0,214.28571428571428L168.33333333333331,</span>
<span class="s">171.42857142857142L336.66666666666663,0L505,128.57142857142858L505,</span>
<span class="s">300L336.66666666666663,300L168.33333333333331,300L0,300Z&quot;</span><span class="nt">/&gt;</span>
</pre></div>


<p>The last two sections adds the axes to the SVG. There isn&rsquo;t much to say
about them.</p>
<h4>Make it pretty</h4>
<p>In &ldquo;Putting it all together&rdquo;, I ignored the <code>.attr("class", "area")</code>
explanations. D3 can add any tag attributes with <code>attr()</code>. I added some
<code>class</code> attributes so that the graph can be styled. SVG uses different
properties than standard HTML tags, but the styling below gave
the graph its simple look.</p>
<div class="codehilite"><pre><span class="nt">svg</span> <span class="p">{</span> <span class="k">border</span><span class="o">:</span> <span class="m">1px</span> <span class="k">solid</span> <span class="m">#dedede</span><span class="p">;</span> <span class="p">}</span>

<span class="nc">.axis</span> <span class="nt">path</span><span class="o">,</span> <span class="nc">.axis</span> <span class="nt">line</span> <span class="p">{</span>
  <span class="n">fill</span><span class="o">:</span> <span class="k">none</span><span class="p">;</span>
  <span class="n">stroke</span><span class="o">:</span> <span class="m">#000</span><span class="p">;</span>
  <span class="n">shape</span><span class="o">-</span><span class="n">rendering</span><span class="o">:</span> <span class="n">crispEdges</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.area</span> <span class="p">{</span> <span class="n">fill</span><span class="o">:</span> <span class="m">#4ca3bd</span><span class="p">;</span> <span class="p">}</span>
</pre></div>


<h4>Other charts</h4>
<p>In this post, I covered the basics of making an area chart. In future posts,
I will explain how to use other types of data and how to make stacked
area charts. Stay tuned!</p>
<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>

<script src='area.js'></script>
<p>If you want to chat about this with me, I'm
  <a href="https://twitter.com/mblayman">@mblayman</a> on Twitter.</p>
  <br>
  <footer>
    <p><img alt='Creative Commons Attribution 4.0 International License'
      src='/cc.png' width='80' height='15'> <a href='/'> Matt Layman</a>,
      2015</p>
  </footer>
</div>
</body>
</html><!-- handrolled for excellence -->
