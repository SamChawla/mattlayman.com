<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <link rel='stylesheet' href='/screen.css'>
  <link href='http://fonts.googleapis.com/css?family=Cabin:600|Lora'
    rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">
  <title>Extending handroll for fun - mattlayman.com</title>
  <meta name='viewport' content='width=device-width' />
  <link rel='alternate' href='/feed.xml' title="Matt Layman's Writings"
    type='atom+xml'>
</head>
<body>
<div id='container'>
  <h1>Extending handroll for fun</h1>
<p class='byline'>By <a href='/'>Matt Layman</a> on July 30, 2015</p>
<p><img class='book' src='outlet.jpg'></p>
<p>I released handroll 2.0 with a shiny new extension interface.
This post will make a new extension from soup to nuts
to demonstrate the ease of such a task.
We&rsquo;ll call it the <code>ObnoxiousExtension</code>.
Our extension will make some noise on the console.</p>
<p>Let&rsquo;s start with the code.
<a href="obnoxious.py">Download the extension</a>
to play with it yourself.</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">handroll.extensions.base</span> <span class="kn">import</span> <span class="n">Extension</span>


<span class="k">class</span> <span class="nc">ObnoxiousExtension</span><span class="p">(</span><span class="n">Extension</span><span class="p">):</span>
    <span class="n">handle_pre_composition</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">handle_frontmatter_loaded</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">handle_post_composition</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">on_pre_composition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">director</span><span class="p">):</span>
        <span class="k">print</span> <span class="s1">&#39;Let</span><span class="se">\&#39;</span><span class="s1">s get this party started!&#39;</span>

    <span class="k">def</span> <span class="nf">on_frontmatter_loaded</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_file</span><span class="p">,</span> <span class="n">frontmatter</span><span class="p">):</span>
        <span class="k">print</span> <span class="s1">&#39;YO! Da front matter loaded.&#39;</span>

    <span class="k">def</span> <span class="nf">on_post_composition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">director</span><span class="p">):</span>
        <span class="k">print</span> <span class="s1">&#39;Peace out, homeslice!&#39;</span>
</pre></div>


<p>An extension must do two things:</p>
<ol>
<li>Declare what signals it should be notified about.</li>
<li>Do its work in a signal handler method.</li>
</ol>
<p>To express interest a signal,
set the <code>handle_*</code> class attribute to <code>True</code>.
This will cause the extension to register with the signal
and receive events when they occur.</p>
<p>The extension can process a signal with the handler method.
The handler method has a set signature,
but anything goes in the body of the method.
In the example,
I did a boring <code>print</code> statement.</p>
<p>All the signals and handler methods that you can use
are in the <a href="http://handroll.readthedocs.org/en/latest/extensions.html">extension documentation</a>.
Any work that you do beyond the class attributes
and handlers is entirely in your hands.</p>
<p>Once your extension is ready,
you need to hook it in using a setuptools entry point.
I created a minimal <code>setup.py</code> file
(which is also <a href="setup.py">available for download</a>)
to show that setuptools configuration.</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">setuptools</span> <span class="kn">import</span> <span class="n">setup</span>

<span class="n">setup</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;handroll-obnoxious&#39;</span><span class="p">,</span>
    <span class="n">version</span><span class="o">=</span><span class="s1">&#39;0.1&#39;</span><span class="p">,</span>
    <span class="n">install_requires</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;handroll&#39;</span><span class="p">],</span>
    <span class="n">py_modules</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;obnoxious&#39;</span><span class="p">],</span>
    <span class="n">entry_points</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;handroll.extensions&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s1">&#39;obnoxious = obnoxious:ObnoxiousExtension&#39;</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">},</span>
<span class="p">)</span>
</pre></div>


<p>In this entry point,
<code>obnoxious</code> on the left hand side is the name of the extension.
<code>obnoxious</code> on the right hand side is the module name
and <code>ObnoxiousExtension</code> is the class name.</p>
<p>That&rsquo;s it for code.
If you followed along,
<code>python setup.py sdist</code> should create a source distribution to use.
You can install the newly minted package
and make your handroll site generation obnoxious.</p>
<p>To use the extension,
add <code>with_obnoxious = True</code>
to the <code>[site]</code> section of your <code>handroll.conf</code>.
While editing this post with the extension enabled,
I got this output
whenever I saved the source file.</p>
<div class="codehilite"><pre><span></span>Let&#39;s get this party started!
YO! Da front matter loaded.
Peace out, homeslice!
</pre></div>


<p>I hope this gives you a clear idea
of how to make a handroll extension.
The source distribution for this little example
is <a href="handroll-obnoxious-0.1.tar.gz">available for download</a>.</p>
<p>If you want to chat about this with me, I'm
  <a href="https://twitter.com/mblayman">@mblayman</a> on Twitter.</p>
  <br>
  <footer>
    <p><img alt='Creative Commons Attribution 4.0 International License'
      src='/cc.png' width='80' height='15'> <a href='/'> Matt Layman</a>,
      2017</p>
  </footer>
</div>
</body>
</html><!-- handrolled for excellence -->
